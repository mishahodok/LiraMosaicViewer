<Window x:Class="LiraMosaicViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:view="clr-namespace:LiraMosaicViewer.View"
        Title="Lira Mosaic Viewer" Width="1500" Height="900"
        WindowStartupLocation="CenterScreen">
    <DockPanel>

        <!-- Верхняя панель -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="8">
            <TextBlock Text="Папка:" VerticalAlignment="Center"/>
            <TextBox x:Name="FolderTextBox" Width="380" Margin="8,0,0,0"/>

            <Button Content="Обновить" Click="Refresh_Click" Margin="8,0,0,0" Padding="10,4"/>

            <Separator Width="16" Opacity="0"/>
            <TextBlock Text="Отчёт:" VerticalAlignment="Center" Margin="16,0,0,0"/>
            <ComboBox x:Name="ReportComboBox"
          Width="140"
          Margin="8,0,0,0"
          SelectionChanged="Report_SelectionChanged"/>


            <TextBlock Text="Поле:" VerticalAlignment="Center"/>
            <ComboBox x:Name="FieldComboBox" Width="90" Margin="8,0,0,0"
                      SelectionChanged="Field_SelectionChanged"/>

            <Separator Width="16" Opacity="0"/>

            <TextBlock Text="Загружение:" VerticalAlignment="Center"/>
            <ComboBox x:Name="LoadCaseComboBox"
                      Width="220"
                      Margin="8,0,0,0"
                      DisplayMemberPath="Display"
                      SelectionChanged="LoadCase_SelectionChanged"/>
            <TextBlock Text="РСН:" VerticalAlignment="Center" Margin="16,0,0,0"/>
            <ComboBox x:Name="RsnComboBox"
          Width="110"
          Margin="8,0,0,0"
          ItemStringFormat="РСН {0}"
          SelectionChanged="Rsn_SelectionChanged"/>


            <CheckBox x:Name="MeshCheckBox"
                      Content="Сетка"
                      IsChecked="True"
                      Margin="16,0,0,0"
                      VerticalAlignment="Center"/>

            <Separator Width="16" Opacity="0"/>
            <TextBlock x:Name="StatusTextBlock" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Основная область -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="660"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Слева: плиты -->
            <GroupBox Grid.Column="0" Header="Найденные пары таблиц" Margin="8">
                <ListBox x:Name="PairsListBox"
                         SelectionChanged="PairsListBox_SelectionChanged"
                         DisplayMemberPath="DisplayName"/>
            </GroupBox>

            <!-- Центр: предпросмотр + кнопки добавления -->
            <Grid Grid.Column="1" Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" BorderBrush="#777" BorderThickness="1">
                    <view:A4ReportView x:Name="ReportView"/>
                </Border>

                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,0">
                    <Button x:Name="AddCurrentButton"
                            Content="Добавить текущий лист"
                            Click="AddCurrent_Click"
                            Padding="10,6"/>

                    <Button x:Name="AddAllLcButton"
                            Content="Добавить все варианты загружения текущей плиты"
                            Click="AddAllLoadCases_Click"
                            Padding="10,6"
                            Margin="8,0,0,0"/>
                </StackPanel>
            </Grid>

            <!-- Справа: очередь экспорта + настройки -->
            <Grid Grid.Column="2" Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <GroupBox Grid.Row="0" Header="Листы на экспорт">
                    <DockPanel>
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="▲" Width="28" Click="MoveUp_Click"/>
                            <Button Content="▼" Width="28" Margin="6,0,0,0" Click="MoveDown_Click"/>
                            <Button Content="Удалить" Margin="12,0,0,0" Click="RemoveSelected_Click"/>
                        </StackPanel>

                        <ListBox x:Name="ExportQueueListBox"
                                 SelectionMode="Extended">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding DisplayLine}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Foreground" Value="Black"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsNoData}" Value="True">
                                                        <Setter Property="Foreground" Value="Red"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>
                </GroupBox>

                <!-- Настройки экспорта -->
                <GroupBox Grid.Row="1" Header="Настройки экспорта" Margin="0,8,0,0">
                    <StackPanel Margin="8">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Папка PDF:" Width="90" VerticalAlignment="Center"/>
                            <TextBox x:Name="OutputFolderTextBox" Width="260"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Стартовый №:" Width="90" VerticalAlignment="Center"/>
                            <TextBox x:Name="StartSheetNumberTextBox" Width="80"/>
                        </StackPanel>

                        <CheckBox x:Name="OnePdfCheckBox"
                                  Content="Собрать в один PDF-файл"
                                  IsChecked="True"
                                  Margin="0,0,0,6"/>

                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Обработка:" Width="90" VerticalAlignment="Center"/>
                            <ComboBox x:Name="ExportModeComboBox" Width="180">
                                <ComboBoxItem Content="Растровая (работает)" IsSelected="True"/>
                                <ComboBoxItem Content="Векторная (позже)"/>
                            </ComboBox>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                            <TextBlock Text="Качество (DPI):" Width="90" VerticalAlignment="Center"/>
                            <ComboBox x:Name="DpiComboBox" Width="180">
                                <ComboBoxItem Content="150"/>
                                <ComboBoxItem Content="300" IsSelected="True"/>
                                <ComboBoxItem Content="600"/>
                            </ComboBox>
                        </StackPanel>

                    </StackPanel>
                </GroupBox>

                <Button x:Name="ExportPdfButton"
        Grid.Row="2"
        Content="Экспорт PDF"
        Click="ExportPdf_Click"
        Padding="14,8"
        Margin="0,10,0,0"/>

                <StackPanel Grid.Row="3" Margin="0,6,0,0">
                    <ProgressBar x:Name="ExportProgressBar"
                 Height="16"
                 Minimum="0"
                 Maximum="100"
                 Value="0"/>

                    <TextBlock x:Name="ExportProgressTextBlock"
               Margin="0,4,0,0"
               TextWrapping="Wrap"/>

                    <TextBlock x:Name="ExportStatusTextBlock"
               Margin="0,4,0,0"
               TextWrapping="Wrap"/>
                </StackPanel>

            </Grid>

        </Grid>
    </DockPanel>
</Window>
